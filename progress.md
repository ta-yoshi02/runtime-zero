Original prompt: Vite + Phaser で 2D横スクロールアクション「Runtime: Zero」を段階実装。今回は最初の縦切りとして、Viteデフォルト画面を Phaser 起動へ置換し、Title → Stage Select → Stage1 → Result の遷移、可変ジャンプ/ジャンプバッファ/コヨーテを最初から実装し、拡張しやすい構成にする。仮アセットで進める。

## 2026-02-06
- セッション開始。skills: develop-web-game / playwright を適用。imagegen は今回未使用（仮図形アセットのため）。
- Phaser最小縦切りを実装: Scene分割（Boot/Title/StageSelect/StagePlay/Result）、session store、stage data、入力システム、プレイヤー制御を追加。
- 操作感（可変ジャンプ/ジャンプバッファ/コヨーテ）を `PlayerController` に実装。
- Pauseメニュー（Resume/Restart/Exit）と Result 戻り導線を追加。
- `window.render_game_to_text` を各Sceneで公開。
- `vite.config.ts` を追加し、`VITE_BASE_PATH` または `VITE_USE_GH_PAGES_BASE=1` / `GITHUB_ACTIONS=true` で `base='/runtime-zero/'` に切替可能化。
- 検証: `npm run build` 成功、`VITE_USE_GH_PAGES_BASE=1 npm run build` 成功（dist内の参照が `/runtime-zero/` になることを確認）。
- 制約: Playwright導入/実行はネットワーク到達不可（ENOTFOUND registry.npmjs.org）で未実施。dev server は 127.0.0.1:5173 で 200 応答を確認。
- Main Menu/Credits/Tuning Scene を追加し、画面フローを Title -> Main Menu -> Stage Select -> Ingame -> Result に拡張。
- Stage Select から Options(Tuning) 遷移を追加（O/F1）。
- Tuning UI を実装：スライダー調整（キー/マウス対応）+ `localStorage` 永続化（`runtime-zero:tuning-overrides:v1`）。
- プレイヤー操作を拡張：Run（Shift/X）、Wall Jump、Slide（Run+Down）、Ground Pound（空中Down）。
- Mirror時の左右入力反転を追加（ステージ反転と整合）。
- カメラ先読みを通常/ダッシュで分離し、Tuning値を反映。
- 検証: `npm run build` 成功、`VITE_USE_GH_PAGES_BASE=1 npm run build` 成功。
- 保留: 自動プレイ検証（Playwright導入不能のため）、敵/アイテム/変身/攻撃/CI/README 等。
- 再開後の現状確認を実施。未コミット差分は保持されており、build/test は現時点で成功。
- skills確認: develop-web-game / playwright / imagegen の SKILL.md を読み、適用順を明確化。imagegen は現段階で画像生成タスク未着手。
- develop-web-game要件補完として `window.advanceTime(ms)` を `src/game/index.ts` に追加。
- `vite.config.ts` の base 切替を強化（`GITHUB_PAGES=true` でも `/runtime-zero/` を選択可能）。
- 公開運用ファイルを追加: `README.md`, `LICENSE`(MIT), `docs/stage-design.md`, `.github/workflows/pages.yml`。
- Playwright実プレイは依然としてネットワーク制限で未実施（`registry.npmjs.org` ENOTFOUND）。
- CI workflow更新: `actions/configure-pages@v5` を追加し、main push時の Pages artifact/deploy を安定化。
- 検証ループ: `npm run build`, `npm test`, `VITE_USE_GH_PAGES_BASE=1 npm run build` を再実行し全て成功。
- 不具合修正: クリア後Result遷移時に `StagePlay.finishRun()` が `physics.world.pause()` を残し、次回ステージ開始後に操作してもキャラが動かない症状を確認。
- 対応: `StagePlay.create()` 先頭で `physics.world.resume()`、`finishRun()` から pause を除去、さらに `ResultScene.create()` でも `physics.world.resume()` を実施して復帰を保証。
- Result画面遷移の再不具合に対処: `ResultScene` の入力を `GameInput + JustDown` のみから、キーボード状態リセット (`keyboard.resetKeys`) と生 `keydown` ハンドラ併用に変更。
- Enter/NumpadEnter/Space -> Stage Select, R -> Retry, T/Escape -> Main Menu を明示的に処理し、遷移ロックで多重startを防止。
- 追加対処: Result画面に `window.addEventListener('keydown')` フォールバックを追加し、Phaser keyboard plugin 側が不発でも遷移できるようにした。
- さらにクリック遷移ボタン（Stage Select / Retry / Main Menu）をResult下部に追加し、キーボード非依存でも復帰可能にした。
- 最終フォールバック追加: Result画面で Phaser input が完全停止しても遷移できるよう、`#app` 直下に DOM ボタン（Stage Select/Retry/Main Menu）をマウント。
- さらに12秒で Stage Select へ自動遷移するタイムアウトを追加し、Resultでの詰みを防止。
- Result遷移を `transitionTo()` に一本化し、`scene.start()` 後300msで target scene が active でない場合は `Title` へ自動復旧する watchdog を追加。
- 目的: Resultからの遷移時に次シーン起動失敗でフリーズフレームが残るケースを自動回復。
- 追加修正: Result shutdown 時に watchdog を消してしまい、遷移失敗時の回復が走らない不具合を修正。
- watchdog判定を `isActive && isVisible && !isSleeping` に強化し、未起動時は Title へ確実復帰するようにした。
- 遷移失敗フェイルセーフを追加: `bootIntent` (sessionStorage) を導入し、Resultからの遷移失敗時は目的sceneを保存して `window.location.reload()`。
- BootScene で bootIntent を消費し、stage/difficulty/mirror を復元して目的sceneへ直接復帰。
- SessionStore に `setDifficulty` / `setMirror` を追加して復元経路を明示。
- ユーザー要望に合わせて Result画面の重複UIを撤去。追加していた in-canvas ボタン群と DOM フォールバックボタンを削除し、表示は元のキーヒントのみへ戻した。
- 遷移安定化の中核（window keydown fallback + watchdog/reload fallback）は維持。
